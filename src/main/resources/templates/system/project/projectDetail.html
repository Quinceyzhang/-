<!DOCTYPE HTML>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org"
xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
	<h2 class="thin text-center" th:text="【+${project.projectName}+】详情"></h2>
	<h3 class="thin text-center" style="display:none" id="projectId" th:text="${project.projectId}"></h3>
	<form class="form-horizontal m" id="form-projectCaseSteps-edit">
		<div class="col-sm-3 " style="width:20%;">
			<shiro:hasPermission name="system:project:edit">
                <a id="adds" class="btn btn-info btn-edit" onclick="showDetail()">
                    <i class="fa fa-list-ol"></i> 添加设备
                </a>
            </shiro:hasPermission> 
			<table class="table table-striped" id="equipmentsTable">
				<thead>
					<tr>
						<th width="50%">设备名称：</th>
						<td width="50%">
							<div class="col-sm-12 lf-td-div">
								<label th:name="equipment" th:id="equipment" th:value="${equipmentsList[0].equipment}" th:text="${equipmentsList[0].equipment}"></label>
							</div>
						</td>
					</tr>
				</thead>
				
				<tbody id="equipmentsTBody">
					<tr>
						<th>设备型号：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="model" th:id="model" th:value="${equipmentsList[0].model}" th:text="${equipmentsList[0].model}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>数量：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="count" th:id="count" th:value="${equipmentsList[0].count}" th:text="${equipmentsList[0].count}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>检测人员：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="testBy" th:id="testBy" th:value="${equipmentsList[0].testBy}" th:text="${equipmentsList[0].testBy}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>检测时间：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="testTime" th:id="testTime" th:value="${equipmentsList[0].testTime}" th:text="${equipmentsList[0].testTime}"></label>
							</div>
						</td>
					</tr>
					
					<tr>
						<th>商标：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="logo" th:id="logo" th:value="${equipmentsList[0].logo}" th:text="${equipmentsList[0].logo}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>样品等级：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="sampleGrade" th:id="sampleGrade" th:value="${equipmentsList[0].sampleGrade}" th:text="${equipmentsList[0].sampleGrade}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>样品编号：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="sampleDescrip" th:id="sampleDescrip" th:value="${equipmentsList[0].sampleDescrip}" th:text="${equipmentsList[0].sampleDescrip}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>样品描述：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="sampleNum" th:id="sampleNum" th:value="${equipmentsList[0].sampleNum}" th:text="${equipmentsList[0].sampleNum}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>抽样基数：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="sampleBasicNum" th:id="sampleBasicNum" th:value="${equipmentsList[0].sampleBasicNum}" th:text="${equipmentsList[0].sampleBasicNum}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>生产厂家：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="productor" th:id="productor" th:value="${equipmentsList[0].productor}" th:text="${equipmentsList[0].productor}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>生产日期：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="productDate" th:id="productDate" th:value="${equipmentsList[0].productDate}" th:text="${equipmentsList[0].productDate}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>受检单位：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="inspectedCompany" th:id="inspectedCompany" th:value="${equipmentsList[0].inspectedCompany}" th:text="${equipmentsList[0].inspectedCompany}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>委托单位：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="trustCompany" th:id="trustCompany" th:value="${equipmentsList[0].trustCompany}" th:text="${equipmentsList[0].trustCompany}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>检测性质：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="testProperty" th:id="testProperty" th:value="${equipmentsList[0].testProperty}" th:text="${equipmentsList[0].testProperty}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>检测依据：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="testBasis" th:id="testBasis" th:value="${equipmentsList[0].testBasis}" th:text="${equipmentsList[0].testBasis}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>环境温度：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="temperature" th:id="temperature" th:value="${equipmentsList[0].temperature}" th:text="${equipmentsList[0].temperature}"></label>
							</div>
						</td>
					</tr>
					<tr>
						<th>相对湿度：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="humidity" th:id="humidity" th:value="${equipmentsList[0].humidity}" th:text="${equipmentsList[0].humidity}"></label>
							</div>
						</td>
					</tr>
					
					<tr>
						<th>备注：</th>
						<td>
							<div class="col-sm-12 lf-td-div">
								<label th:name="remark" th:id="remark" th:value="${equipmentsList[0].remark}" th:text="${equipmentsList[0].remark}"></label>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="col-sm-8 select-table table-striped" style="width:80%">
			<table id="bootstrap-table" data-mobile-responsive="true" style="table-layout:fixed"></table>
			<shiro:hasPermission name="system:project:edit">
                <a id="addf" class="btn btn-success" style="display:table;margin: 0 auto" onclick="showAdd()">
                    <i class="fa fa-edit"></i> 添加方案
                </a>
        </shiro:hasPermission> 
		</div>
	</form>
</div>

<div th:include="include::footer"></div>
<!-- bootstrap-suggest 下拉搜索框插件 -->
<script th:src="@{/ajax/libs/bootstrap-suggest/bootstrap-suggest.min.js}"></script>
<script>

		    var projectId = $("#projectId").html();
	        //var prefix = ctx + "testmanagmt/projectCaseParams";
	        var prefixadd = ctx + "system/project";
	        
	        var editFlag = "testmanagmt:projectPlan:edit";
	        var removeFlag = "testmanagmt:projectPlan:remove";
	        var prefix = ctx + "testmanagmt/projectPlan";
	        var prefixFather = ctx + "system/project";
	      
	        $(function() {
	        	btnStatus();
	            var options = {
	                url: prefixadd + "/planListForProject",
	                //createUrl: prefix + "/add",
	                //updateUrl: prefix + "/edit/{id}",
	                //customUrl: prefix + "/editTestCase/{id}",
	                customEquipUrl: prefixFather + "/editEquipment/{id}",
	                customPlanUrl: prefixFather + "/planList/{id}",
	                //removeUrl: prefix + "/remove",
					//exportUrl: prefix + "/export",
					showSearch: false,   // 是否显示检索信息
                    showRefresh: false, // 是否显示刷新按钮
                    //showColumns: $.common.visible(options.showColumns), // 是否显示隐藏某列下拉框
                    showColumns: false,
                    showToggle: false,   // 是否显示详细视图和列表视图的切换按钮
	                //modalName: "测试方案",
	                //childrenModalName: "测试方案用例编辑",
					search: false,
					queryParams: function(params) {
		            	return {
		        			// 传递参数查询参数
		                    pageSize:       params.limit,
		                    pageNum:        params.offset / params.limit + 1,
		                    searchValue:    params.search,
		                    orderByColumn:  params.sort,
		                    isAsc:          params.order,
		                    projectId:      projectId
		        		};
					},
			        showExport: false,
			        detailView: true, //是否显示父子表
	                columns: [{
			            checkbox: true,
			            visible: false
			        },
					{
						field : 'planId', 
						title : '测试方案ID',
						visible: false,
						formatter: function (value, row, index) {
	                        return '<a class="btn btn-info btn-edit" onclick="$.operate.customFull('+row.planId+')">'+value+'</a>';
	                    }
					},
					{
						field : 'planName', 
						title : '方案名称',
						width : '7%',
						class : 'myTDLengthHidden'
					},

					{
						field : 'createBy', 
						title : '创建者',
						align: "center",
						width : '10%'
					},
					{
						field : 'createTime', 
						title : '创建时间',
						align: "center",
						width : '10%'
					},
					/* {
						field : 'updateBy', 
						title : '更新者',
						width : '10%',
						class : 'myTDLengthHidden'
					},
					{
						field : 'updateTime', 
						title : '更新时间',
						width : '15%',
						class : 'myTDLengthHidden',
						sortable: true
					}, */
					{
						field : 'remark', 
						title : '备注',
						align: "center",
						width : '10%',
						class : 'myTDLengthHidden'
					},
/* 			        {
			            title: '操作',
			            align: 'center',
						width : '20%',
						class : 'myTDLengthHidden',
			            formatter: function(value, row, index) {
			            	var actions = [];
			            	actions.push('<a class="btn btn-info btn-xs " onclick="$.operate.customFull('+row.planId+')"><i class="fa fa-list-ol"></i>详情</a> ');
			            	actions.push('<a class="btn btn-success btn-xs ' + editFlag + '" href="#" onclick="$.operate.edit(\'' + row.planId + '\')"><i class="fa fa-edit"></i>编辑</a> ');
	                        actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" onclick="$.operate.remove(\'' + row.planId + '\')"><i class="fa fa-remove"></i>删除</a>');
							return actions.join('');
			            }
			        } */
					],	
			//注册加载子表的事件。注意下这里的三个参数！
		        onExpandRow: function (index, row, $detail) {
		           InitSubTable(index, row, $detail);
		        	}		
	            };
	            
	            //初始化子表格(无限循环)
	            InitSubTable = function (index, row, $detail) {
	                var cur_table = $detail.html('<table style="table-layout:fixed"></table>').find('table');
	                $(cur_table).bootstrapTable({
	                    url: prefix + '/testCaseList',
	                    method: 'get',
	                    queryParams: {
	                        planId: row.planId
	                    },
	                    clickToSelect: true,
	                    detailView: true,//父子表
	                    uniqueId: "testCaseId",
	                    
	                    onLoadSuccess: function (result) {
	                        console.log(result);
	                        $(cur_table).bootstrapTable('load', result);
	                    },
	                    
	                    columns: [ 
	                    {
	                        field: 'testCaseId',
	                        title: '用例编号',
	                        width: '15%',
	                        class: 'myTDLengthHidden',
	                        visible: false
	                    }, {
	                        field: 'testCaseName',
	                        title: '用例名称',
	                        align: "center",
	                        width: '7%',
	                        class: 'myTDLengthHidden'
	                    }, {
	                        field: 'createBy',
	                        title: '创建人',
	                        align: "center",
	                        width: '10%',
	                        class: 'myTDLengthHidden'
	                    }, {
	                        field: 'createTime',
	                        title: '创建时间',
	                        align: "center",
	                        width: '10%',
	                        class: 'myTDLengthHidden'
	                        /* formatter: function (value,
	                                row, index) {
					               return $.common.formatTime(value);
					           } */
	                    },{
	                        field: 'remark',
	                        title: '备注',
	                        align: "center",
	                        width: '10%',
	                        class: 'myTDLengthHidden'
	                    }],
	                    onExpandRow: function (index, row, $detail) {
	     		           InitSubSubTable(index, row, $detail);
	     		        	}
	                    
	                });
	            };
	            
		        //初始化子表格(无限循环)
		        InitSubSubTable = function (index, row, $detail) {
		            var cur_table = $detail.html('<table style="table-layout:fixed"></table>').find('table');
		            $(cur_table).bootstrapTable({
		                url: ctx + 'testmanagmt/testCase/actionList',
		                method: 'get',
		                queryParams: {
		                	testCaseId: row.testCaseId
		                },
		                clickToSelect: true,
		                detailView: true,//父子表
		                uniqueId: "actionId",
		                columns: [{
		                    checkbox: true,
		                    visible: false
		                }, {
		                    field: 'actionId',
		                    title: '动作编号',
		                    width: '5%',
		                    class: 'myTDLengthHidden',
		                    visible: false
		                }, {
		                    field: 'actionName',
		                    title: '动作名称',
		                    align: "right",
		                    width: '7%',
		                    class: 'myTDLengthHidden'
		                }, {
		                    field: 'createBy',
		                    title: '创建人',
		                    align: "center",
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                }, {
		                    field: 'createTime',
		                    title: '创建时间',
		                    align: "center",
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                    /* formatter: function (value,
	                                row, index) {
					               return $.common.formatTime(value);
					           } */
		                }, {
		                    field: 'remark',
		                    title: '备注',
		                    align: "center",
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                }],
		                
		                onExpandRow: function (index, row, $detail) {
		     		           InitSubSubSubTable(index, row, $detail);
		     		        	}
		            });

		        };

		        InitSubSubSubTable = function (index, row, $detail) {
		            var cur_table = $detail.html('<table style="table-layout:fixed"></table>').find('table');
		            $(cur_table).bootstrapTable({
		                url: ctx + 'testmanagmt/action/paramsList',
		                method: 'get',
		                queryParams: {
		                    actionId: row.actionId
		                },
		                clickToSelect: true,
		                detailView: false,//父子表
		                uniqueId: "paramsId",
		                columns: [{
		                    checkbox: true,
		                    visible: false
		                }, {
		                    field: 'paramsId',
		                    title: '参数编号',
		                    width: '15%',
		                    align: "right",
		                    class: 'myTDLengthHidden'
		                }, {
		                    field: 'paramsName',
		                    title: '参数名称',
		                    align: "center",
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                }, {
		                    field: 'paramsUnit',
		                    title: '单位',
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                }, {
		                    field: 'postId',
		                    title: '仪器编号',
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                }, {
		                    field: 'postName',
		                    title: '仪器',
		                    width: '10%',
		                    class: 'myTDLengthHidden'
		                }]
		            });

		        };
	            
	            $.table.init(options);
	        });
	        function btnStatus() {
	        	var status = sessionStorage.getItem('jczxglzt');
	        	if(status == 0 || status == 1) {
	        		$('#adds').css('display', 'initial');
	        		$('#addf').css('display', 'table');
	        	}else {
	        		$('#adds').css('display', 'none');
	        		$('#addf').css('display', 'none');
	        	}
	        }
	        function showDetail () {
	        	var id = sessionStorage.getItem('jczxgl');
	        	$.operate.customFullEquip(id);
	        }
	        function showAdd () {
	        	var id = sessionStorage.getItem('jczxgl');
	        	$.operate.customFullPlan(id);
	        }
</script>
</body>
</html>
